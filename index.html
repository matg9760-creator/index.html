<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wordle FR – Clone fidèle</title>
<style>
:root{
  --bg:#121213;
  --tile:#121213;
  --border:#3a3a3c;
  --text:#d7dadc;
  --green:#6aaa64;
  --yellow:#c9b458;
  --gray:#3a3a3c;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, Arial, sans-serif;
  display:flex;
  justify-content:center;
}
.app{width:100%;max-width:420px;padding:10px}
header{text-align:center}
h1{letter-spacing:4px;margin:10px 0}

.board{display:flex;flex-direction:column;gap:6px;align-items:center}
.row{display:flex;gap:6px}
.tile{
  width:56px;height:56px;
  border:2px solid var(--border);
  background:var(--tile);
  display:flex;align-items:center;justify-content:center;
  font-size:28px;font-weight:bold;
  user-select:none;
  cursor:pointer;
}
.tile.active{border-color:#5383ff;box-shadow:0 0 0 2px rgba(83,131,255,.35) inset}
.tile.green{background:var(--green);border-color:var(--green);color:#fff}
.tile.yellow{background:var(--yellow);border-color:var(--yellow);color:#fff}
.tile.gray{background:var(--gray);border-color:var(--gray);color:#fff}

.keyboard{margin-top:18px}
.kb-row{display:flex;justify-content:center;gap:5px;margin-bottom:6px}
.key{
  background:#818384;color:white;
  padding:10px;border-radius:4px;
  font-weight:bold;min-width:28px;text-align:center;
  cursor:pointer;user-select:none
}
.key.wide{min-width:50px}
.key.green{background:var(--green)}
.key.yellow{background:var(--yellow)}
.key.gray{background:#1f1f1f;color:#777}

.row.shake{animation:shake .4s}
@keyframes shake{
  0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)}
}
</style>
</head>
<body>
<div class="app">
<header>
  <h1>WORDLE</h1>
  <div style="margin-bottom:8px;">
    <label>Mode :</label>
    <select id="modeSelect">
      <option value="5">5 lettres</option>
      <option value="6">6 lettres</option>
    </select>
  </div>
  <button id="startBtn">Jouer</button>
</header>
<div id="board"></div>
<div id="keyboard" class="keyboard"></div>
</div>

<script>
/*************** DICTIONNAIRES (TEST) ***************/
const WORDS_5 = ['SALON','TABLE','PORTE','LIVRE','STYLO','PLAGE','FLEUR','NEIGE','SABLE','TRAIN'];
const WORDS_6 = ['MAISON','JARDIN','PLAGES','SOLEIL','ROUTES','ECOLES','AMOURS','NEIGES','BUREAU','VOYAGE'];

/*************** ÉTAT DU JEU ***************/
let solution = '';
let currentRow = 0;
let currentCol = 0;
let grid = [];
let gameOver = false;
let gameStarted = false; // une seule déclaration, contrôle du cycle de vie
let WORD_LENGTH = 5;
const MAX_ROWS = 6;

const board = document.getElementById('board');
const keyboard = document.getElementById('keyboard');
const startBtn = document.getElementById('startBtn');
const modeSelect = document.getElementById('modeSelect');

/*************** SÉLECTION DE CASE ***************/
function selectTile(r,c){
  if(gameOver) return;
  if(r !== currentRow) return; // uniquement la ligne courante
  document.querySelectorAll('.tile.active').forEach(t=>t.classList.remove('active'));
  currentRow = r;
  currentCol = c;
  const tile = document.getElementById(`tile-${r}-${c}`);
  if(tile) tile.classList.add('active');
}

/*************** INITIALISATION ***************/
function startGame(){
  // Empêche tout redémarrage en cours de partie
  if(gameStarted) return;
  gameStarted = true;

  startBtn.disabled = true; // empêche un redémarrage accidentel
  startBtn.blur();

  WORD_LENGTH = parseInt(modeSelect.value,10);
  const list = WORD_LENGTH === 5 ? WORDS_5 : WORDS_6;
  solution = list[Math.floor(Math.random()*list.length)];
  console.log('Mot:', solution); // debug

  currentRow = 0;
  currentCol = 0;
  gameOver = false;
  grid = Array.from({length:MAX_ROWS},()=>Array(WORD_LENGTH).fill(''));
  drawBoard();
  drawKeyboard();
}

/*************** GRILLE ***************/
function drawBoard(){
  board.innerHTML='';
  board.className='board';
  for(let r=0;r<MAX_ROWS;r++){
    const row=document.createElement('div');
    row.className='row';
    for(let c=0;c<WORD_LENGTH;c++){
      const tile=document.createElement('div');
      tile.className='tile';
      tile.id=`tile-${r}-${c}`;
      tile.onclick=()=>selectTile(r,c);
      row.appendChild(tile);
    }
    board.appendChild(row);
  }
  selectTile(0,0);
}

/*************** CLAVIER ***************/
const KEYS = ['AZERTYUIOP','QSDFGHJKLM','WXCVBN'];
function drawKeyboard(){
  keyboard.innerHTML='';
  KEYS.forEach(line=>{
    const row=document.createElement('div');
    row.className='kb-row';
    [...line].forEach(letter=>{
      const key=document.createElement('div');
      key.className='key';
      key.textContent=letter;
      key.onclick=()=>handleKey(letter);
      row.appendChild(key);
    });
    keyboard.appendChild(row);
  });
  const row=document.createElement('div');
  row.className='kb-row';
  const enter=document.createElement('div');
  enter.className='key wide';
  enter.textContent='Entrer';
  enter.onclick=checkWord;
  const back=document.createElement('div');
  back.className='key wide';
  back.textContent='Suppr';
  back.onclick=backspace;
  row.appendChild(enter);
  row.appendChild(back);
  keyboard.appendChild(row);
}

/*************** SAISIE ***************/
function handleKey(letter){
  if(gameOver) return;
  if(currentCol>=WORD_LENGTH) return;
  grid[currentRow][currentCol]=letter;
  const t = document.getElementById(`tile-${currentRow}-${currentCol}`);
  if(t) t.textContent=letter;
  if(currentCol < WORD_LENGTH-1){
    selectTile(currentRow, currentCol+1);
  } else {
    selectTile(currentRow, currentCol);
  }
}

function backspace(){
  if(gameOver) return;
  if(grid[currentRow][currentCol]==='' && currentCol>0){
    selectTile(currentRow, currentCol-1);
  }
  grid[currentRow][currentCol]='';
  const t = document.getElementById(`tile-${currentRow}-${currentCol}`);
  if(t) t.textContent='';
}

/*************** LOGIQUE WORDLE ***************/
function checkWord(){
  if(gameOver) return;
  document.querySelectorAll('.tile.active').forEach(t=>t.classList.remove('active'));

  const guess = grid[currentRow].join('');
  if(guess.length<WORD_LENGTH){
    document.querySelectorAll('.row')[currentRow].classList.add('shake');
    return;
  }

  const result = Array(WORD_LENGTH).fill('gray');
  const solArr = solution.split('');

  // Verts
  for(let i=0;i<WORD_LENGTH;i++){
    if(guess[i]===solArr[i]){
      result[i]='green';
      solArr[i]=null;
    }
  }

  // Jaunes
  for(let i=0;i<WORD_LENGTH;i++){
    if(result[i]==='gray'){
      const idx=solArr.indexOf(guess[i]);
      if(idx!==-1){
        result[i]='yellow';
        solArr[idx]=null;
      }
    }
  }

  // Appliquer couleurs
  for(let i=0;i<WORD_LENGTH;i++){
    const tile=document.getElementById(`tile-${currentRow}-${i}`);
    tile.classList.remove('green','yellow','gray');
    tile.classList.add(result[i]);
    colorKey(guess[i], result[i]);
  }

  if(guess===solution){
    gameOver = true;
    gameStarted = false;
    startBtn.disabled = false;
    alert('Bravo !');
    return;
  }

  currentRow++;
  currentCol=0;
  if(!gameOver && currentRow<MAX_ROWS){
    selectTile(currentRow,0);
  }
  if(currentRow>=MAX_ROWS){
    gameOver = true;
    gameStarted = false;
    startBtn.disabled = false;
    alert('Perdu ! Mot : '+solution);
  }
}

function colorKey(letter,color){
  document.querySelectorAll('.key').forEach(k=>{
    if(k.textContent===letter){
      if(color==='green'){
        k.className='key green';
      } else if(color==='yellow' && !k.classList.contains('green')){
        k.className='key yellow';
      } else if(color==='gray' && !k.classList.contains('green') && !k.classList.contains('yellow')){
        k.className='key gray';
      }
    }
  });
}

/*************** CLAVIER PHYSIQUE ***************/
window.addEventListener('keydown',e=>{
  if(['Enter','Backspace'].includes(e.key)){
    e.preventDefault();
  }
  if(e.key>='a' && e.key<='z') handleKey(e.key.toUpperCase());
  if(e.key==='Backspace') backspace();
  if(e.key==='Enter') checkWord();
});

/*************** TESTS AUTOMATIQUES ***************/
console.assert(typeof startGame === 'function', 'startGame est défini');
console.assert(typeof drawBoard === 'function', 'drawBoard est défini');
console.assert(typeof checkWord === 'function', 'checkWord est défini');
console.assert(Array.isArray(WORDS_5) && WORDS_5.length>0, 'WORDS_5 valide');
console.assert(Array.isArray(WORDS_6) && WORDS_6.length>0, 'WORDS_6 valide');
console.assert(MAX_ROWS === 6, 'MAX_ROWS vaut 6');

/*************** LANCEMENT ***************/
startBtn.addEventListener('click', startGame);
</script>
</body>
</html>
