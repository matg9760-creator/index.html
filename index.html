<script>

/* =========================
   DICTIONNAIRES
========================= */

const WORDS_5 = ["SALON","TABLE","PORTE","PLAGE","FLEUR","TRAIN","ARBRE","IMAGE","TERRE","CHAUD"];
const WORDS_6 = ["MAISON","JARDIN","SOLEIL","ROUTES","BUREAU","VOYAGE","ANIMAL","ORANGE","SAISON","TRAJET"];

/* =========================
   VARIABLES
========================= */

let WORD_LENGTH = 5;
let solution = "";
let grid = [];
let row = 0;
let col = 0;
let gameOver = false;
const MAX_ROWS = 6;

const board = document.getElementById("board");
const keyboard = document.getElementById("keyboard");
const modeSelect = document.getElementById("modeSelect");

const keyStates = {}; // mÃ©morise meilleur Ã©tat

modeSelect.addEventListener("change", startGame);

/* =========================
   START
========================= */

function startGame(){

  WORD_LENGTH = parseInt(modeSelect.value);
  const list = WORD_LENGTH === 5 ? WORDS_5 : WORDS_6;
  solution = list[Math.floor(Math.random()*list.length)];

  row=0;
  col=0;
  gameOver=false;

  grid = Array.from({length:MAX_ROWS},()=>Array(WORD_LENGTH).fill(""));

  // Reset clavier
  for (let k in keyStates) delete keyStates[k];

  drawBoard();
  drawKeyboard();
  selectTile(0,0);
}

/* =========================
   BOARD
========================= */

function drawBoard(){
  board.innerHTML="";
  for(let r=0;r<MAX_ROWS;r++){
    const rowDiv=document.createElement("div");
    rowDiv.className="row";
    for(let c=0;c<WORD_LENGTH;c++){
      const tile=document.createElement("div");
      tile.className="tile";
      tile.id=`t-${r}-${c}`;
      tile.onclick=()=>selectTile(r,c);
      rowDiv.appendChild(tile);
    }
    board.appendChild(rowDiv);
  }
}

function selectTile(r,c){
  if(gameOver || r!==row) return;
  document.querySelectorAll(".tile").forEach(t=>t.classList.remove("active"));
  col=c;
  document.getElementById(`t-${r}-${c}`).classList.add("active");
}

/* =========================
   KEYBOARD
========================= */

function drawKeyboard(){
  keyboard.innerHTML="";
  const KEYS=["AZERTYUIOP","QSDFGHJKLM","WXCVBN"];

  KEYS.forEach(line=>{
    const r=document.createElement("div");
    r.className="kb-row";
    [...line].forEach(letter=>{
      const key=document.createElement("div");
      key.className="key";
      key.textContent=letter;
      key.onclick=()=>type(letter);
      r.appendChild(key);
    });
    keyboard.appendChild(r);
  });

  const r=document.createElement("div");
  r.className="kb-row";

  const enter=document.createElement("div");
  enter.className="key wide";
  enter.textContent="Entrer";
  enter.onclick=check;

  const back=document.createElement("div");
  back.className="key wide";
  back.textContent="âŒ«";
  back.onclick=backspace;

  r.append(enter,back);
  keyboard.appendChild(r);
}

/* =========================
   INPUT
========================= */

function type(letter){
  if(gameOver || col>=WORD_LENGTH) return;

  grid[row][col]=letter;
  document.getElementById(`t-${row}-${col}`).textContent=letter;

  if(col<WORD_LENGTH-1){
    col++;
    selectTile(row,col);
  }
}

function backspace(){
  if(col>0 && grid[row][col]==="") col--;
  grid[row][col]="";
  document.getElementById(`t-${row}-${col}`).textContent="";
  selectTile(row,col);
}

/* =========================
   WORDLE LOGIC
========================= */

function check(){

  if(grid[row].includes("")) return;

  const guess = grid[row].join("");
  const solutionArray = solution.split("");
  const result = Array(WORD_LENGTH).fill("gray");

  // Compter occurrences
  const letterCount = {};
  solutionArray.forEach(l=>{
    letterCount[l]=(letterCount[l]||0)+1;
  });

  // VERT
  for(let i=0;i<WORD_LENGTH;i++){
    if(guess[i]===solution[i]){
      result[i]="green";
      letterCount[guess[i]]--;
    }
  }

  // JAUNE
  for(let i=0;i<WORD_LENGTH;i++){
    if(result[i]==="gray" && letterCount[guess[i]]>0){
      result[i]="yellow";
      letterCount[guess[i]]--;
    }
  }

  // Appliquer
  for(let i=0;i<WORD_LENGTH;i++){
    document.getElementById(`t-${row}-${i}`).classList.add(result[i]);
    updateKeyboardColor(guess[i], result[i]);
  }

  if(guess===solution){
    gameOver=true;
    setTimeout(()=>alert("Bravo ! ðŸŽ‰"),200);
    return;
  }

  row++;
  col=0;

  if(row===MAX_ROWS){
    gameOver=true;
    setTimeout(()=>alert("Perdu ! Mot : "+solution),200);
  } else {
    selectTile(row,0);
  }
}

/* =========================
   CLAVIER PRIORITÃ‰ CORRECTE
========================= */

function updateKeyboardColor(letter,color){

  const priority = {gray:1, yellow:2, green:3};

  if(!keyStates[letter] || priority[color] > priority[keyStates[letter]]){

    keyStates[letter]=color;

    document.querySelectorAll(".key").forEach(key=>{
      if(key.textContent===letter){
        key.className="key "+color;
      }
    });
  }
}

/* =========================
   CLAVIER PHYSIQUE
========================= */

window.addEventListener("keydown",e=>{
  if(e.key==="Enter") check();
  else if(e.key==="Backspace") backspace();
  else if(/^[a-z]$/i.test(e.key)) type(e.key.toUpperCase());
});

startGame();

</script>
