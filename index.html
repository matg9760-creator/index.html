<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wordle FR – Version Stable</title>
<style>
:root{
  --bg:#121213;
  --tile:#121213;
  --border:#3a3a3c;
  --text:#d7dadc;
  --green:#6aaa64;
  --yellow:#c9b458;
  --gray:#3a3a3c;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  font-family:system-ui, Arial, sans-serif;
}
.app{
  width:100%;
  max-width:420px;
  padding:10px;
}
header{ text-align:center; margin:10px 0; }
h1{ letter-spacing:4px; margin:0; }

.board{ display:flex; flex-direction:column; gap:6px; align-items:center; }
.row{ display:flex; gap:6px; }
.tile{
  width:56px; height:56px;
  border:2px solid var(--border);
  background:var(--tile);
  display:flex; align-items:center; justify-content:center;
  font-size:28px; font-weight:bold;
}
.tile.active{ border-color:#5383ff; }

.keyboard{ margin-top:18px; }
.kb-row{ display:flex; justify-content:center; gap:5px; margin-bottom:6px; }
.key{
  background:#818384; color:white;
  padding:10px; border-radius:4px;
  font-weight:bold; min-width:28px; text-align:center;
  cursor:pointer; user-select:none;
}
.key.wide{ min-width:50px; }
.key.green{ background:var(--green); }
.key.yellow{ background:var(--yellow); }
.key.dark{ background:#1f1f1f; color:#777; }

/* Popup */
.modal-overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.6);
  display:none; align-items:center; justify-content:center;
}
.modal{
  background:#1a1a1b;
  padding:20px;
  border-radius:8px;
  text-align:center;
}
.modal button{ margin-top:10px; padding:6px 12px; }

/* ===== Animations Wordle ===== */
.tile.pop{ animation: pop 120ms ease-in-out; }
@keyframes pop{ 0%{transform:scale(1)} 50%{transform:scale(1.12)} 100%{transform:scale(1)} }

.reveal{ animation: flip 600ms ease forwards; transform-style:preserve-3d; }
@keyframes flip{ 0%{transform:rotateX(0deg)} 45%{transform:rotateX(-90deg)} 55%{transform:rotateX(-90deg)} 100%{transform:rotateX(0deg)} }

.row.shake{ animation: row-shake 450ms ease; }
@keyframes row-shake{
  0%{transform:translateX(0)}
  15%{transform:translateX(-6px)}
  30%{transform:translateX(6px)}
  45%{transform:translateX(-4px)}
  60%{transform:translateX(4px)}
  75%{transform:translateX(-2px)}
  100%{transform:translateX(0)}
}

.board.win-shake{ animation: win-shake 600ms ease; }
@keyframes win-shake{
  0%{transform:translateX(0)}
  15%{transform:translateX(-6px)}
  30%{transform:translateX(6px)}
  45%{transform:translateX(-4px)}
  60%{transform:translateX(4px)}
  75%{transform:translateX(-2px)}
  100%{transform:translateX(0)}
}

.board.win-bounce{ animation: win-bounce 800ms cubic-bezier(.34,1.56,.64,1); }
@keyframes win-bounce{
  0%{transform:scale(1)}
  30%{transform:scale(1.06)}
  55%{transform:scale(0.97)}
  75%{transform:scale(1.03)}
  100%{transform:scale(1)}
}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>WORDLE</h1>
    <div style="margin-top:8px;text-align:center;">
      <label style="font-size:12px;color:#d7dadc;">Mode :</label>
      <select id="modeSelect" style="background:#1a1a1b;color:white;border:1px solid #3a3a3c;border-radius:4px;padding:4px 6px;">
        <option value="5">5 lettres</option>
        <option value="6">6 lettres</option>
      </select>
    </div>
    <div style="margin-top:6px;text-align:center;">
      <label style="font-size:12px;color:#d7dadc;">Difficulté :</label>
      <select id="difficultySelect" style="background:#1a1a1b;color:white;border:1px solid #3a3a3c;border-radius:4px;padding:4px 6px;">
        <option value="easy">Facile</option>
        <option value="normal" selected>Normal</option>
        <option value="hard">Difficile</option>
      </select>
    </div>
  </header>
  <div id="boardWrap"></div>
  <div id="keyboard" class="keyboard"></div>
</div>

<!-- Popup -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h2 id="modalTitle"></h2>
    <p id="modalText"></p>
    <button onclick="closeModal()">Rejouer</button>
  </div>
</div>

<!-- Champ caché pour capter le clavier physique (désactivé sur mobile) -->
<input id="kbd-capture" readonly inputmode="none" type="text" autocomplete="off" autocapitalize="off" spellcheck="false"
       style="position:fixed;opacity:0;pointer-events:none;height:0;width:0;">

<script>
// ================================
// Wordle FR - Version stable, sans caractères invalides
// ================================

// ---------- Utilitaires de tests (auto-tests simples) ----------
function assert(cond, msg){
  if(!cond){ console.error('TEST FAILED:', msg); }
  else{ console.log('TEST OK:', msg); }
}

// ---------- Sons (Web Audio API) ----------
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
function ensureAudio(){
  if(!audioCtx){ audioCtx = new AudioCtx(); }
}

function playTone(freq, duration, type='sine', volume=0.12){
  ensureAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type;
  osc.frequency.value = freq;
  gain.gain.value = volume;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
  osc.stop(audioCtx.currentTime + duration);
}

function soundTap(){ playTone(520, 0.05, 'square', 0.08); }
function soundEnter(){ playTone(420, 0.08, 'triangle', 0.12); }
function soundWin(){ playTone(660, 0.12, 'sine', 0.15); setTimeout(()=>playTone(880, 0.15, 'sine', 0.18), 140); }
function soundLose(){ playTone(220, 0.18, 'sawtooth', 0.12); }

window.addEventListener('click', ()=>{ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); }, { once:true });

// ---------- Dictionnaires (ASCII uniquement, pas d'accents) ----------
const WORDS_5 = [
  'ABORD','ACTIF','AIMER','ALBUM','ARBRE','BALAI','BLANC','BOULE','BRUIT','CADRE',
  'CARTE','CHAUD','CHIEN','CHOSE','COEUR','DANSE','DEBUT','DOIGT','DOUTE','ECRAN',
  'ECOLE','ENFER','EPAIS','ETUDE','FAIRE','FLEUR','FROID','FRUIT','GARDE','GENRE',
  'GLACE','GRAIN','GRAND','GUIDE','HABIT','HERBE','HOTEL','HUILE','IDEAL','IMAGE',
  'INDEX','JAUNE','JOUER','LARGE','LIVRE','MAINS','MAJOR','MARIN','MATCH','MATIN',
  'METAL','METRE','MONDE','NAVAL','NEIGE','NOEUD','OCEAN','ODEUR','OPERA','ORAGE',
  'PAIRE','PARIS','PARLE','PASSE','PETIT','PHARE','PIANO','PLACE','PLUME','POINT',
  'POIRE','POMME','PORTE','PRISE','PROIE','QUART','RADAR','RAIDE','REGLE','ROBOT',
  'ROUGE','ROUTE','SALON','SCENE','SERIE','SIEGE','SIGNE','SINGE','SOLDE','SONDE',
  'TABLE','TARDE','TEMPS','TERRE','TITRE','TRIER','TROIS','UNITE','USAGE','VENTE',
  'VERRE','VESTE','VILLE','VOILE','VOTER','ZEBRE'
];

const WORDS_6 = [
  'ABIMER','ABORDS','ABSENT','ACCORD','ACTION','ADOPTE','ADRESSE','AFFAIRE','AGENCE','AGENDA',
  'ALERTE','AMENER','AMICAL','ANCIEN','ANIMER','ANNUEL','APERCU','ARBRES','ARGENT','ARRETE',
  'ARRIVE','ASPECT','ASSURE','ATTAQUE','AUTEUR','AUTOUR','AVANCE','AVISER','BAGAGE','BALCON',
  'BANQUE','BATEAU','BEAUTE','BESOIN','BILLET','BLAGUE','BLASON','BLOQUE','BOUTON','BRILLE',
  'BRIQUE','BUREAU','CABINE','CADEAU','CAMION','CANARD','CAPTER','CARBON','CARNET','CASQUE',
  'CENTRE','CERISE','CHAINE','CHAISE','CHANGE','CHANTE','CHARGE','CHASSE','CHEMIN','CHERIR',
  'CHOISI','CIMENT','CITRON','CLASSE','CLIENT','CLIQUE','COFFRE','COINCE','COLLER','COMBAT',
  'COMMUN','CONCER','CONFIE','CONTRE','COPIER','CORDES','CORNES','COUPER','COURIR','COUSIN',
  'CREMES','CROIRE','CROISE','DANGER','DANSER','DECIDE','DEFEND','DELAIS','DEMAND','DENIER',
  'DESERT','DESIRE','DETEND','DEVANT','DEVOIR','DIGNES','DINERS','DOIGTS','DOUCES','DOUTER',
  'DRESSE','DROITS','DURCIR','ECHANGE','ECHECS','ECLAIR','ECRIRE','EDITER','EFFACE','EGLISE',
  'ELARGI','ELEVES','EMPLOI','ENFANT','ENJEUX','ENVOYE','EQUIPE','ERRANT','ESPACE','ESSAIS',
  'ETAGES','ETUDES','EXACTE','EXPOSE','FAIBLE','FAMINE','FAUTES','FEMMES','FERMER','FICHES',
  'FIGURE','FILTRE','FINALE','FLEURS','FORMER','FORCES','FOURNI','FRANCS','FRUITS','GAGNER',
  'GARANT','GARCON','GENTIL','GESTES','GLOIRE','GOUTER','GRANDS','GROUPE','GUIDER','HABITS',
  'HERBES','HUMAINS','IMAGES','IMPACT','IMPOTS','INVITE','JARDIN','JETONS','JOINTS','JUNGLE',
  'LACHER','LANCES','LARGES','LECONS','LECTUR','LENTES','LEVERS','LIBERE','LIGNES','LIMITI',
  'LOGEES','LUMIER','MACHER','MAIGRE','MAISON','MANIER','MARQUE','MELANGE','MENTAL','MERITE',
  'METTRE','MILIEU','MINUTE','MIRAGE','MODELE','MOMENT','MONDES','MONTER','MORALE','MOTEUR',
  'MOURIR','MUSCLE','NAITRE','NATION','NATURE','NEIGES','NIVEAU','NOMBRE','NORMES','NOTION',
  'NOUVEL','NUAGES','OBLIGE','OBTENU','OCEANS','OCCUPE','OFFERT','OFFICE','OPPOSE','ORDRES',
  'ORGANE','OUVERT','PALIER','PANIER','PARTIE','PASSER','PENSER','PERDRE','PERILS','PERSIL',
  'PETITS','PIECES','PILOTE','PLACER','PLAGES','POINTS','PORTER','POSTER','POULET','POURRA',
  'PRENDS','PRINCE','PROJET','PROMET','PROPRE','PROUVE','PUNITS','QUARTS','QUETES','RACINE',
  'RAPIDE','RAYONS','REAGIR','RECITS','REFUSE','REGLES','REJOUE','RELIEF','REMPLI','RENARD',
  'RENDRE','RETOUR','REVEIL','RICHES','RIVAGE','ROCHES','ROULER','ROUTES','SACHET','SAISIE',
  'SALLES','SAVOIR','SCENES','SEANCE','SECHER','SENIOR','SERVIR','SIGNAL','SIMPLE','SINGES',
  'SOLIDE','SONNER','SORTIE','SOUDER','SOURIS','STABLE','SUITES','TABLES','TALENT','TARDER',
  'TEMOIN','TENANT','TENUES','TERRES','TIRAGE','TISSUS','TOMBER','TRACES','TRAINS','TROUVE',
  'TUNNEL','UNIQUE','UNITES','USAGES','USINES','UTILIS','VAGUES','VALEUR','VENDRE','VENTES',
  'VERITE','VESTES','VIGNES','VILLES','VISAGE','VITALE','VIVANT','VOILES','VOISIN','VOYAGE'
];

// ---------- Nettoyage automatique ----------
function cleanWords(list, length){
  return [...new Set(
    list
      .map(w => String(w).normalize('NFD').replace(/[\u0300-\u036f]/g, ''))
      .map(w => w.toUpperCase().trim())
      .filter(w => w.length === length)
  )];
}

let WORDS_5_CLEAN = cleanWords(WORDS_5, 5);
let WORDS_6_CLEAN = cleanWords(WORDS_6, 6);

// Tests automatiques sur les dictionnaires
assert(WORDS_5_CLEAN.length > 0, 'WORDS_5_CLEAN non vide');
assert(WORDS_6_CLEAN.length > 0, 'WORDS_6_CLEAN non vide');
assert(WORDS_5_CLEAN.every(w => /^[A-Z]{5}$/.test(w)), 'Tous les mots 5 lettres valides');
assert(WORDS_6_CLEAN.every(w => /^[A-Z]{6}$/.test(w)), 'Tous les mots 6 lettres valides');

// ---------- Etat du jeu ----------
let solution = '';
let difficulty = 'normal';
let wordLength = 5;
let board = [];
let row = 0, col = 0, gameOver = false;

const boardWrap = document.getElementById('boardWrap');
const keyboard = document.getElementById('keyboard');

function startGame(){
  const mode = document.getElementById('modeSelect');
  wordLength = parseInt(mode.value, 10);
  const list = wordLength === 5 ? WORDS_5_CLEAN : WORDS_6_CLEAN;
  solution = list[Math.floor(Math.random()*list.length)];
  board = Array.from({length:6}, ()=> Array(wordLength).fill(''));
  row = 0; col = 0; gameOver = false;
  renderBoard();
  renderKeyboard();
  selectTile(0,0);
}

// ---------- Rendu ----------
function renderBoard(){
  boardWrap.innerHTML = '';
  const b = document.createElement('div'); b.className = 'board';
  for(let r=0;r<6;r++){
    const line = document.createElement('div'); line.className = 'row';
    for(let c=0;c<wordLength;c++){
      const t = document.createElement('div');
      t.className = 'tile';
      t.id = `tile-${r}-${c}`;
      t.onclick = () => selectTile(r,c);
      line.appendChild(t);
    }
    b.appendChild(line);
  }
  boardWrap.appendChild(b);
}

const KB = ['AZERTYUIOP','QSDFGHJKLM','WXCVBN'];
function renderKeyboard(){
  keyboard.innerHTML = '';
  KB.forEach(r=>{
    const rowDiv = document.createElement('div'); rowDiv.className = 'kb-row';
    [...r].forEach(ch=>{
      const k = document.createElement('div'); k.className = 'key'; k.textContent = ch;
      k.onclick = () => handleKey(ch);
      rowDiv.appendChild(k);
    });
    keyboard.appendChild(rowDiv);
  });
  const act = document.createElement('div'); act.className = 'kb-row';
  const enter = document.createElement('div'); enter.className = 'key wide'; enter.textContent = 'Entrer'; enter.onclick = onEnter;
  const back = document.createElement('div'); back.className = 'key wide'; back.textContent = 'Suppr'; back.onclick = onBack;
  act.appendChild(enter); act.appendChild(back);
  keyboard.appendChild(act);
}

// ---------- Entrées ----------
function handleKey(letter){
  if(gameOver) return;
  soundTap();
  if(col < wordLength){
    board[row][col] = letter;
    const tile = document.getElementById(`tile-${row}-${col}`);
    tile.textContent = letter;
    tile.classList.remove('pop'); void tile.offsetWidth; tile.classList.add('pop');
    if(col < wordLength-1) selectTile(row, col+1);
  }
}

function onBack(){
  if(gameOver) return;
  soundTap();
  if(col > 0) col--;
  board[row][col] = '';
  const tile = document.getElementById(`tile-${row}-${col}`);
  tile.textContent = '';
  selectTile(row,col);
}

function onEnter(){
  if(gameOver) return;
  soundEnter();
  const rowEl = document.querySelectorAll('.row')[row];

  if(board[row].includes('')){
    rowEl.classList.remove('shake'); void rowEl.offsetWidth; rowEl.classList.add('shake');
    return;
  }

  revealRow();

  if(board[row].join('') === solution){
    const boardEl = document.querySelector('.board');
    boardEl.classList.add('win-shake');
    setTimeout(()=>{
      boardEl.classList.remove('win-shake');
      boardEl.classList.add('win-bounce');
      setTimeout(()=>boardEl.classList.remove('win-bounce'),900);
    },650);
    soundWin();
    showModal('Bravo !', 'Mot trouvé : ' + solution);
    gameOver = true; return;
  }

  row++; col = 0;
  if(row >= 6){
    soundLose();
    showModal('Perdu', 'Mot : ' + solution);
    gameOver = true; return;
  }
  selectTile(row,0);
}

function revealRow(){
  const guess = board[row].join('');
  const sol = solution.split('');
  const res = Array(wordLength).fill('gray');

  for(let i=0;i<wordLength;i++){
    if(guess[i] === sol[i]){ res[i] = 'green'; sol[i] = null; }
  }
  for(let i=0;i<wordLength;i++){
    if(res[i] === 'gray'){
      const idx = sol.indexOf(guess[i]);
      if(idx !== -1){ res[i] = 'yellow'; sol[idx] = null; }
    }
  }

  for(let i=0;i<wordLength;i++){
    const t = document.getElementById(`tile-${row}-${i}`);
    t.classList.remove('reveal'); void t.offsetWidth; t.classList.add('reveal');
    if(res[i] === 'green') t.style.background = 'var(--green)';
    else if(res[i] === 'yellow') t.style.background = 'var(--yellow)';
    else t.style.background = 'var(--gray)';
  }
  updateKeyboard(guess, res);
}

function updateKeyboard(guess, res){
  for(let i=0;i<wordLength;i++){
    const letter = guess[i];
    const keys = [...document.querySelectorAll('.key')].filter(k=>k.textContent === letter);
    keys.forEach(k=>{
      if(res[i] === 'green') k.className = 'key green';
      else if(res[i] === 'yellow' && !k.classList.contains('green')) k.className = 'key yellow';
      else if(res[i] === 'gray') k.className = 'key dark';
    });
  }
}

function selectTile(r,c){
  document.querySelectorAll('.tile').forEach(t=>t.classList.remove('active'));
  row = r; col = c;
  const t = document.getElementById(`tile-${r}-${c}`);
  if(t) t.classList.add('active');
}

// ---------- Popup ----------
function showModal(title,text){
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalText').textContent = text;
  document.getElementById('modal').style.display = 'flex';
}
window.closeModal = function(){
  document.getElementById('modal').style.display = 'none';
  startGame();
};

// ---------- Clavier physique PC ----------
const accentMap = {
  'é':'E','è':'E','ê':'E','ë':'E','à':'A','â':'A','ä':'A','î':'I','ï':'I','ô':'O','ö':'O','ù':'U','û':'U','ü':'U','ç':'C'
};

window.addEventListener('keydown', (e) => {
  if(gameOver) return;
  if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(e.key)) e.preventDefault();
  if(e.key === 'Enter'){ e.preventDefault(); onEnter(); return; }
  if(e.key === 'Backspace'){ e.preventDefault(); onBack(); return; }
  let key = e.key;
  if(accentMap[key]) key = accentMap[key]; else key = key.toUpperCase();
  if(/^[A-Z]$/.test(key)){
    e.preventDefault();
    handleKey(key);
  }
});

// ---------- Initialisation ----------
const modeSelect = document.getElementById('modeSelect');
const difficultySelect = document.getElementById('difficultySelect');
modeSelect.addEventListener('change', startGame);
difficultySelect.addEventListener('change', ()=>{ difficulty = difficultySelect.value; });

// Tests d'initialisation
assert(document.getElementById('boardWrap') !== null, 'boardWrap existe');
assert(document.getElementById('keyboard') !== null, 'keyboard existe');

startGame();
</script>
</body>
</html>
